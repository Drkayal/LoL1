# Users Module - إدارة المستخدمين

هذا المجلد يحتوي على جميع دوال إدارة المستخدمين في مشروع Bot Factory.

## الملفات المضمنة

### 1. `validation.py` - دوال التحقق من المدخلات
يحتوي على جميع دوال التحقق من صحة المدخلات:

#### دوال التحقق الأساسية:
- `validate_user_id(user_id)`: التحقق من صحة معرف المستخدم
- `validate_bot_token(token)`: التحقق من صحة توكن البوت
- `validate_session_string(session)`: التحقق من صحة كود الجلسة
- `validate_bot_username(username)`: التحقق من صحة معرف البوت

#### دوال التحقق الإضافية:
- `validate_message(message)`: التحقق من صحة رسالة Telegram
- `validate_callback_query(callback_query)`: التحقق من صحة استعلام Callback

**الميزات:**
- تحقق شامل من صحة المدخلات
- رسائل خطأ واضحة ومفصلة
- دعم أنواع البيانات المختلفة
- معالجة الأخطاء المتقدمة

### 2. `logic.py` - دوال إدارة المستخدمين
يحتوي على جميع دوال إدارة المستخدمين:

#### دوال إدارة المستخدمين الأساسية:
- `is_dev(user_id, max_retries=3)`: التحقق من صلاحيات المطور
- `is_user(user_id, max_retries=3)`: التحقق من وجود المستخدم
- `add_new_user(user_id, max_retries=3)`: إضافة مستخدم جديد
- `del_user(user_id, max_retries=3)`: حذف مستخدم
- `get_users(max_retries=3)`: الحصول على قائمة المستخدمين

#### دوال إضافية:
- `get_user_count(max_retries=3)`: الحصول على عدد المستخدمين
- `clear_user_cache(user_id=None)`: مسح التخزين المؤقت للمستخدمين
- `get_dev_count()`: الحصول على عدد المطورين
- `set_dependencies(owner_id, devs_coll, users_coll)`: تعيين التبعيات

**الميزات:**
- التخزين المؤقت للاستعلامات المتكررة
- آلية إعادة المحاولة للعمليات الفاشلة
- إدارة التأخير لتجنب الحظر
- معالجة شاملة للأخطاء

## الاستخدام

### استيراد الدوال:
```python
# استيراد دوال التحقق
from users import (
    validate_user_id,
    validate_bot_token,
    validate_session_string,
    validate_bot_username
)

# استيراد دوال إدارة المستخدمين
from users import (
    is_dev,
    is_user,
    add_new_user,
    del_user,
    get_users,
    get_user_count,
    clear_user_cache,
    get_dev_count
)
```

### أمثلة الاستخدام:

#### التحقق من المدخلات:
```python
# التحقق من معرف المستخدم
try:
    is_valid, user_id = validate_user_id("123456789")
    if is_valid:
        print(f"معرف المستخدم صحيح: {user_id}")
except ValidationError as e:
    print(f"خطأ في التحقق: {e.message}")

# التحقق من توكن البوت
try:
    is_valid, token = validate_bot_token("1234567890:ABCdefGHIjklMNOpqrsTUVwxyz")
    if is_valid:
        print("توكن البوت صحيح")
except ValidationError as e:
    print(f"خطأ في التحقق: {e.message}")
```

#### إدارة المستخدمين:
```python
# التحقق من صلاحيات المطور
if is_dev(user_id):
    print("المستخدم مطور")

# التحقق من وجود المستخدم
if await is_user(user_id):
    print("المستخدم موجود")

# إضافة مستخدم جديد
if await add_new_user(user_id):
    print("تم إضافة المستخدم بنجاح")

# الحصول على قائمة المستخدمين
users_list = await get_users()
print(f"عدد المستخدمين: {len(users_list)}")

# الحصول على عدد المستخدمين
count = await get_user_count()
print(f"عدد المستخدمين: {count}")
```

## التبعيات

### المتغيرات المطلوبة:
- `OWNER_ID`: قائمة معرفات المالكين
- `devs_collection`: مجموعة المطورين في قاعدة البيانات
- `users`: مجموعة المستخدمين في قاعدة البيانات

### تعيين التبعيات:
```python
# يجب استدعاء هذه الدالة عند بدء التطبيق
set_dependencies(OWNER_ID, devs_collection, users)
```

## الميزات المتقدمة

### 1. التخزين المؤقت:
- تخزين مؤقت لصلاحيات المطورين
- تخزين مؤقت لوجود المستخدمين
- تخزين مؤقت لقوائم المستخدمين
- إدارة ذكية للتخزين المؤقت

### 2. آلية إعادة المحاولة:
- إعادة المحاولة التلقائية للعمليات الفاشلة
- تأخير بين المحاولات لتجنب الحظر
- عدد محاولات قابل للتخصيص
- تسجيل مفصل للأخطاء

### 3. إدارة التأخير:
- تأخير بين عمليات قاعدة البيانات
- تجنب الحظر من Telegram
- تحسين الأداء العام
- إدارة ذكية للموارد

### 4. معالجة الأخطاء:
- أنواع أخطاء مخصصة
- رسائل خطأ واضحة
- تسجيل مفصل للأخطاء
- استرداد آمن من الأخطاء

## الفوائد من هذا التقسيم

1. **سهولة الصيانة**: كل جزء مسؤول عن وظيفة محددة
2. **إعادة الاستخدام**: يمكن استخدام هذه الدوال في مشاريع أخرى
3. **سهولة الاختبار**: يمكن اختبار كل دالة بشكل منفصل
4. **تنظيم الكود**: فصل واضح بين التحقق والمنطق
5. **سهولة التطوير**: يمكن تطوير كل جزء بشكل مستقل
6. **تحسين الأداء**: التخزين المؤقت وإدارة الموارد المحسنة