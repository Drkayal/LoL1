# Database Module - مجلد قاعدة البيانات

هذا المجلد يحتوي على جميع دوال إدارة قاعدة البيانات والتخزين المؤقت للمشروع.

## الملفات

### `__init__.py`
ملف تهيئة المجلد الذي يعرض جميع الدوال والكلاسات المتاحة.

### `manager.py`
يحتوي على `DatabaseManager` لإدارة اتصالات قاعدة البيانات:
- **DatabaseManager**: كلاس لإدارة الاتصالات المتزامنة وغير المتزامنة مع MongoDB
- **get_sync_db()**: الحصول على قاعدة البيانات المتزامنة
- **get_async_db()**: الحصول على قاعدة البيانات غير المتزامنة
- **close_connections()**: إغلاق جميع الاتصالات

### `models.py`
يحتوي على دوال التعامل مع قاعدة البيانات:

#### دوال البث (Broadcast Functions)
- **set_broadcast_status()**: تعيين حالة البث
- **get_broadcast_status()**: الحصول على حالة البث
- **delete_broadcast_status()**: حذف حالة البث

#### دوال البوتات (Bot Functions)
- **get_bot_info()**: الحصول على معلومات البوت
- **save_bot_info()**: حفظ معلومات البوت
- **update_bot_status()**: تحديث حالة البوت
- **delete_bot_info()**: حذف معلومات البوت
- **get_all_bots()**: الحصول على جميع البوتات
- **get_running_bots()**: الحصول على البوتات المشتغلة

#### دوال المصنع (Factory Functions)
- **get_factory_state()**: الحصول على حالة المصنع
- **set_factory_state()**: تعيين حالة المصنع

#### دوال مساعدة (Utility Functions)
- **clear_bot_cache()**: مسح التخزين المؤقت للبوتات
- **clear_factory_cache()**: مسح التخزين المؤقت للمصنع
- **get_database_stats()**: الحصول على إحصائيات قاعدة البيانات
- **set_collections()**: تعيين المجموعات المطلوبة

### `cache.py`
يحتوي على دوال التخزين المؤقت:
- **CacheManager**: كلاس لإدارة التخزين المؤقت
- **get_cache()**: الحصول على قيمة من التخزين المؤقت
- **set_cache()**: حفظ قيمة في التخزين المؤقت
- **delete_cache()**: حذف قيمة من التخزين المؤقت
- **clear_cache()**: مسح جميع البيانات من التخزين المؤقت
- **get_cache_size()**: الحصول على حجم التخزين المؤقت
- **cleanup_expired_cache()**: تنظيف العناصر منتهية الصلاحية
- **get_cache_stats()**: الحصول على إحصائيات التخزين المؤقت
- **cache_database_query()**: تخزين مؤقت لاستعلام قاعدة البيانات
- **invalidate_cache_pattern()**: حذف العناصر التي تطابق نمط معين

## الاستخدام

```python
# استيراد الدوال المطلوبة
from db import (
    set_broadcast_status,
    get_bot_info,
    save_bot_info,
    get_factory_state,
    cache_manager
)

# استخدام الدوال
await set_broadcast_status(user_id, bot_id, "key")
bot_info = get_bot_info("bot_username")
factory_enabled = get_factory_state()
```

## المميزات

1. **إدارة محسنة للاتصالات**: اتصالات متزامنة وغير متزامنة مع MongoDB
2. **التخزين المؤقت**: نظام تخزين مؤقت ذكي مع TTL وLRU
3. **إعادة المحاولة**: آلية إعادة المحاولة للعمليات الفاشلة
4. **التحقق من المدخلات**: تحقق شامل من صحة المدخلات
5. **التأخير الذكي**: تجنب الحظر من خلال التأخير بين العمليات
6. **التنظيف التلقائي**: تنظيف الملفات المؤقتة والتخزين المؤقت
7. **التوثيق الشامل**: تعليقات مفصلة لكل دالة وكلاس